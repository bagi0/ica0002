#- name: Ansible ping module
#  ansible.builtin.ping:
- name: Update APT cache
  ansible.builtin.apt:
    cache_valid_time: 86400

- name: Exporter packages
  apt:
    name: 
      - prometheus-node-exporter
      - nginx

- name: Install certificates
  ansible.builtin.apt:
    name: ca-certificates
    
- name: Add Telegraf rsyslog conf file
  ansible.builtin.template:
    dest: /etc/rsyslog.d/15-telegraf.conf
    src: 15-telegraf.conf
  notify: restart rsyslog

- name: Add the user 'backup' with a specific uid and a primary group of 'admin'
  ansible.builtin.user:
    name: backup
    comment: backup
    create_home: true
    group: backup
    home: /home/backup
    
- name: Create a 2048-bit SSH key for user backup
  ansible.builtin.user:
    name: backup
    generate_ssh_key: yes
    ssh_key_bits: 2048
    ssh_key_file: .ssh/id_rsa
    
- name: Template a file to /home/backup/.ssh/known_hosts
  ansible.builtin.template:
    src: known_hosts
    dest: /home/backup/.ssh/known_hosts
    owner: backup
    group: backup
    mode: 0755
    
- name: Ensure path to mysql backup exists
  ansible.builtin.file:
    path: /home/{{ backup_user }}/influxdb
    owner: "{{ backup_user }}"
    group: "{{ backup_user }}"
    mode: '0755'
    state: directory 

- name: Ensure path to backup restore exists
  ansible.builtin.file:
    path: /home/{{ backup_user }}/restore
    owner: "{{ backup_user }}"
    group: "{{ backup_user }}"
    mode: '0755'
    state: directory 
    
- name: Install Duplicity
  ansible.builtin.apt:
    name: duplicity
    
   
